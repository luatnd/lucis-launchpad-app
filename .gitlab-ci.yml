image: docker/compose:alpine-1.29.2
services:
  - docker:dind
stages:
  # - build
  # - test
  - deploy
default:
  before_script:
    - ./deploy/env.sh

# test:
#   stage: test
#   only:
#     - dev
#   script:
#     - echo running tests in test

deploy-dev:
  stage: deploy
  only:
    - dev
  script:
    - docker build -t lucis_lunchpad_ci:$CI_COMMIT_SHORT_SHA -f ./deploy/Dockerfile .
    - docker run --name lucis_lunchpad_ci --network lucis_network --restart unless-stopped -p 3001:3001 -d lucis_lunchpad_ci:$CI_COMMIT_SHORT_SHA

deploy-prod:
  stage: deploy
  only:
    - main
  script:
    - ./deploy/deploy.sh
  when: manual
